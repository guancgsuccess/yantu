<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="SHORTCUT ICON" href="/images/title.ico"/>
    <title>订单确认支付页面</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="keywords" content="Blue Water Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,
	Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design"/>
    <script type="application/x-javascript"> addEventListener("load", function () {
        setTimeout(hideURLbar, 0);
    }, false);

    function hideURLbar() {
        window.scrollTo(0, 1);
    } </script>

    <!--<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.1.0/css/bootstrap.min.css">-->
    <!--<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>-->
    <!--<script src="https://cdn.staticfile.org/popper.js/1.12.5/umd/popper.min.js"></script>-->
    <!--<script src="https://cdn.staticfile.org/twitter-bootstrap/4.1.0/js/bootstrap.min.js"></script>-->

    <link rel="stylesheet" href="/css/bootstrap123.css"/>
    <link href="/css/style.css" rel='stylesheet' type='text/css'/>
    <script src="/js/jquery-1.11.0.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Exo:100,200,300,400,500,600,700,800,900,100italic,200italic,300italic,400italic,500italic,600italic,700italic,800italic,900italic'
          rel='stylesheet' type='text/css'/>
    <!---- start-smoth-scrolling---->
    <script type="text/javascript" src="/js/move-top.js"></script>
    <link rel="stylesheet" href="/css/searchBox.css">
    <script type="text/javascript">
        jQuery(document).ready(function ($) {
            $(".scroll").click(function (event) {
                event.preventDefault();
                $('html,body').animate({scrollTop: $(this.hash).offset().top}, 1000);
            });
        });
    </script>
    <style>

        .nav {
            display: block;
            list-style: none;
        }

        .services .container {
            width: 90%;
        }

        .services-main .checkout-goods-box {
            padding-top: 10px;
        }

        .services-main .panel {
            margin-bottom: 10px;
            overflow: hidden;
        }

        .services-main .panel .panel-title {
            margin-left: 20px;
            font-size: 23px;
            font-weight: 700;
            line-height: 35px;
            height: 35px;
            color: #333;
            border-bottom: 1px solid #ddd;
        }

        .services-main .product-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        tbody {
            display: table-row-group;
            vertical-align: middle;
            border-color: inherit;
        }

        tr {
            display: table-row;
            vertical-align: inherit;
            border-color: inherit;
        }

        .services-main .product-table th {
            height: 30px;
            line-height: 30px;
            border-bottom: 1px dotted #ddd;
            text-align: center;

        }

        .services-main .product-table .cell-img {
            width: 80px;
            padding: 10px;
        }

        .services-main .product-table .cell-img .p-img {
            width: 80px;
            height: 80px;
            border: 1px solid #ddd;
        }

        .link {
            color: #999;
            text-decoration: none;
            cursor: pointer;
        }

        .services-main .product-table td {
            border-bottom: 1px dotted #ddd;
        }

        .services-main .submit-con {
            text-align: right;
            background: #eee;
        }

        .services-main .submit-con .submit-total {
            font-size: 18px;
            color: #c60023;
            font-weight: 700;
            margin-right: 30px;
            vertical-align: middle;
        }

        .services-main .submit-con .btn {
            display: inline-block;
            padding: 0 20px;
            height: 40px;
            line-height: 40px;
            vertical-align: middle;
            border: none;
            background-color: #c60023;
            font-size: 17px;
            font-weight: 700;
            color: #fff;
            outline: none;
            cursor: pointer;
            text-decoration: none;
        }
    </style>
    <!--start-smoth-scrolling-->
</head>
<body>
<div id="header" xmlns="http://www.w3.org/1999/html">
    <div class="mfw-header">
        <div class="header-wrap clearfix">
            <div class="head-logo">
                <a class="mfw-logo" title="" href="">
                    <img src="/images/logo-yantu.png" height="65px" width="65px">
                </a>
            </div>
            <ul class="head-nav" data-cs-t="headnav" id="_j_head_nav">
                <li class="head-nav-index" data-cs-p="index">
                    <a href="/index" title="首页">首页</a>
                </li>
                <li class="head-nav-place" data-cs-p="mdd">
                    <a href="/queryPlanList" title="周边跟团游">周边跟团游</a>
                </li>
                <li class="head-nav-gonglve" data-cs-p="gonglve">
                    <a href="/queryScenicList" title="热门景点">热门景点</a>
                </li>
                <li class="head-nav-gonglve" data-cs-p="gonglve">
                    <a href="/privateCustom" title="私人订制">私人订制</a>
                </li>
            </ul>
            <div id="pagelet-block-fdfe14e523864f5d21c81cb8e263dfc7" class="pagelet-block" data-api="apps:user:pagelet:pageViewHeadInfo" data-params="{&quot;type&quot;:1}" data-async="1" data-controller="/js/pageletcommon/pageHeadUserInfoWWWNormal">

            </div>
        </div>
        <div class="shadow"></div>
    </div>

    <!----start-top-nav-script---->
    <script type="text/javascript" src="js/responsive-nav.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function($) {
            $(".scroll").click(function(event){
                event.preventDefault();
                $('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
            });
        });
    </script>

</div>

<!--订单支付页面-->
<div class="services">
    <div class="container">
        <div class="services-main">
            <div class="panel">
                <h2 class="panel-title">出游人信息</h2>
                <div class="panel-body order-product" id="touristInfo">

                </div>
            </div>
            <div class="panel">
                <h2 class="panel-title">商品清单</h2>
                <div class="panel-body order-product">
                    <table class="product-table" data-product-id="" data-checked="">
                        <tbody id="productTbody">
                        <tr>
                            <th width="10%">&nbsp;</th>
                            <th width="30%" align="left">商品描述</th>
                            <th width="20%" align="center">价格</th>
                            <th width="20%" align="center">数量</th>
                            <th width="20%" align="center">小计</th>
                        </tr>
                        </tbody>
                    </table>
                    <div class="submit-con"><span>订单总价：
                    </span>
                        <span class="submit-total" id="submit-total">￥0</span>
                        <span class="btn order-submit" onclick="saveOrder()">提交订单</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!---pop-up-box---->
<script type="text/javascript" src="/js/modernizr.custom.min.js"></script>
<link href="/css/popup-box.css" rel="stylesheet" type="text/css" media="all"/>
<script src="/js/jquery.magnific-popup.js" type="text/javascript"></script>
<!---//pop-up-box---->
<div id="small-dialog" class="mfp-hide" style="z-index: 1000">
    <div class="login">
        <h3>登录</h3>
        <h4 id="loginErrorMessage"></h4>
        <a class="play-icon popup-with-zoom-anim" href="#small-dialog1" style="float: right;padding-right:50px;">验证码登录</a>
        <input type="text" value="Cellphone" id="loginCellphone" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Cellphone';}" />
        <input type="password" value="Password" id="loginPassword" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Password';}"/>
        <input type="submit" value="登录" onclick="login()" />
    </div>
    <a  href="forgetPassword" style="padding-right: 200px">忘记密码</a>
    <a class="play-icon popup-with-zoom-anim" href="#small-dialog2" style="float: right;padding-right: 50px">没有账号?去注册</a>
</div>
<div id="small-dialog1" class="mfp-hide" style="z-index: 1000">
    <div class="login">
        <h3>登录</h3>
        <h4 id="loginCodeErrorMessage"></h4>
        <a class="play-icon popup-with-zoom-anim" href="#small-dialog" style="float: right;padding-right:50px;">账号密码登录</a>
        <input type="text" value="Cellphone" id="loginCellphoneByCode" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Cellphone';}" />
        <input type="text" value="验证码" id="loginCode" class="code" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '验证码';}"/>
        <input type="submit" value="   获取验证码   " onclick="code(this)" id="getCode" />
        <input type="submit" value="登录" onclick="loginByCode(this)" />
    </div>
    <a class="play-icon popup-with-zoom-anim" href="#small-dialog2" style="float: right;padding-right: 50px">没有账号?去注册</a>
</div>
<div id="small-dialog2" class="mfp-hide" style="z-index: 1000">
    <div class="signup">
        <h3>注册</h3>
        <h4 id="signUpErrorMessage"></h4>
        <a class="play-icon popup-with-zoom-anim" href="#small-dialog" style="float: right;padding-right:50px;">已有账号?去登录</a>
        <input type="text" id="signUpCellphone" class="cellphone"value="cellphone" onfocus="this.value = '';" onblur="if (this.value === '') {this.value = 'cellphone';}"  />
        <input type="password" id="signUpPassword" value="Password" onfocus="this.value = '';" onblur="if (this.value === '') {this.value = 'Password';}"/>
        <input type="password" id="signUpEnterPassword" value="Password" onfocus="this.value = '';" onblur="if (this.value === '') {this.value = 'signUpPassword';}if (this.value !== document.getElementById('signUpPassword').value) {document.getElementById('signUpErrorMessage').innerText='两次密码不一致哦';} "/>
        <input type="submit"  value="注册" onclick="signUp()"/>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('.popup-with-zoom-anim').magnificPopup({
            type: 'inline',
            fixedContentPos: false,
            fixedBgPos: true,
            overflowY: 'auto',
            closeBtnInside: true,
            preloader: false,
            midClick: true,
            removalDelay: 300,
            mainClass: 'my-mfp-zoom-in'
        });
    });
    var xhr = null;
    function login() {
        if (window.XMLHttpRequest) {
            xhr = new XMLHttpRequest();
        } else {
            xhr = new ActiveXObject('Microsoft.XMLHTTP');
        }
        var url_login = "/yantu/login/login";
        var cellphone = document.getElementById("loginCellphone").value;
        var password =  document.getElementById("loginPassword").value;
        var objData = {
            cellphone : cellphone,
            password : password
        };
        var jsonData = JSON.stringify(objData);
        console.log(objData)
        xhr.open("POST", url_login, true);
        xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
        xhr.onreadystatechange =  function () {
            if(xhr.readyState===4 && xhr.status ===200 ){
                var result= JSON.parse(xhr.responseText);
                localStorage.setItem('loginMessage',JSON.stringify({data:xhr.responseText,time:new Date().getTime()}));
                console.log(localStorage.getItem('loginMessage'));
                if(result.status ===1){
                    var arrayClose = document.getElementsByClassName("mfp-close");
                    for(var i=0;i<arrayClose.length;i++){
                        arrayClose[i].click();
                    }
                    document.getElementById("showPortrait").style.backgroundImage= "url("+result.data.visitorPortrait+")";
                    document.getElementById("loginA").style.display = "none";
                    document.getElementById("logoutA").style.display = "block";
                    document.getElementById("switchMemberA").style.display ="block";
                    document.getElementById("modifyPasswordA").style.display ="block";
                    document.getElementById("modifyInformationA").style.display ="block";
                    document.getElementById("orderManageA").style.display ="block";
                }else{
                    document.getElementById("loginErrorMessage").innerText=result.msg;
                    document.getElementById("loginErrorMessage").style.color="red";
                    localStorage.removeItem('loginMessage');
                }
            }
        };
        xhr.send(jsonData);
    }
    var wait = 60;
    function code(obj) {
        if (window.XMLHttpRequest) {
            xhr = new XMLHttpRequest();
        } else {
            xhr = new ActiveXObject('Microsoft.XMLHTTP');
        }
        var url_code = "/yantu/login/code";
        var cell =  document.getElementById("loginCellphoneByCode").value;
        var objCode = {
            cellPhone : document.getElementById("loginCellphoneByCode").value
        };

        console.log(cell);
        console.log(objCode);
        var jsonCode = JSON.stringify(objCode);
        xhr.open("POST", url_code, true);
        xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
        xhr.onreadystatechange =  function () {
            if(xhr.readyState===4 && xhr.status ===200 ){
                var result = xhr.responseText;
                if(result !== null){
                    localStorage.setItem("loginCode",result);
                }else{
                    document.getElementById("loginCodeErrorMessage").innerText="验证码未知错误";
                    document.getElementById("loginCodeErrorMessage").style.color="red";

                }
            }
        };
        xhr.send(jsonCode);
        time(obj);
    }
    function time(obj) {
        if (wait === 0) {
            obj.removeAttribute("disabled");
            obj.value="   获取验证码   ";
            wait = 60;
        } else {
            obj.setAttribute("disabled", true);
            obj.value=wait+"秒后重新发送";
            wait--;
            console.log(wait)
            t=setTimeout(function() {
                time(obj)
            }, 1000)
        }
    }
    function loginByCode(obj) {
        wait = 60;
        clearTimeout(t);
        document.getElementById("getCode").removeAttribute("disabled");
        document.getElementById("getCode").value = "   获取验证码   ";
        console.log(localStorage.getItem("loginCode"));
        if(document.getElementById("loginCode").value === localStorage.getItem("loginCode")){
            if (window.XMLHttpRequest) {
                xhr = new XMLHttpRequest();
            } else {
                xhr = new ActiveXObject('Microsoft.XMLHTTP');
            }
            var url_login = "/yantu/login/login";
            var cellphone = document.getElementById("loginCellphoneByCode").value;
            var verificationCode =  document.getElementById("loginCode").value;
            var objData = {
                cellphone : cellphone,
                verificationCode : verificationCode
            };
            console.log(objData);
            var jsonData = JSON.stringify(objData);
            xhr.open("POST", url_login, true);
            xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
            xhr.onreadystatechange =  function () {
                if(xhr.readyState===4 && xhr.status ===200 ){
                    var result= JSON.parse(xhr.responseText);
                    console.log(result);
                    localStorage.setItem('loginMessage',JSON.stringify({data:xhr.responseText,time:new Date().getTime()}));
                    if(result.status ===1){
                        var arrayClose = document.getElementsByClassName("mfp-close");
                        for(var i=0;i<arrayClose.length;i++){
                            arrayClose[i].click();
                        }
                        document.getElementById("showPortrait").style.backgroundImage= "url("+result.data.visitorPortrait+")";
                        document.getElementById("loginA").style.display = "none";
                        document.getElementById("logoutA").style.display = "block";
                        document.getElementById("switchMemberA").style.display ="block";
                        document.getElementById("modifyPasswordA").style.display ="block";
                        document.getElementById("modifyInformationA").style.display ="block";
                        document.getElementById("orderManageA").style.display ="block";
                    }else{
                        document.getElementById("loginCodeErrorMessage").innerText=result.msg;
                        document.getElementById("loginCodeErrorMessage").style.color="red";
                        localStorage.removeItem('loginMessage');
                    }
                }
            };
            xhr.send(jsonData);
        }else {
            document.getElementById("loginCodeErrorMessage").innerText="验证码输入错误";
            document.getElementById("loginCodeErrorMessage").style.color="red";
        }

    }
    function signUp() {
        if (window.XMLHttpRequest) {
            xhr = new XMLHttpRequest();
        } else {
            xhr = new ActiveXObject('Microsoft.XMLHTTP');
        }
        var url_register = "/yantu/visitor/register";
        var cellphone = document.getElementById("signUpCellphone").value;
        var password =  document.getElementById("signUpPassword").value;
        var objData = {
            cellphone : cellphone,
            password : password
        };
        var jsonData = JSON.stringify(objData);
        xhr.open("POST", url_register, true);
        xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
        xhr.onreadystatechange =  function () {
            if(xhr.readyState===4 && xhr.status ===200 ){
                var result= JSON.parse(xhr.responseText);
                console.log(result);
                if(result.status ===1){
                    localStorage.removeItem('signUpMessage');
                    localStorage.setItem('signUpMessage',JSON.stringify({data:xhr.responseText,time:new Date().getTime()}));
                    window.location.href = "perfectInformation";
                }else{
                    document.getElementById("signUpErrorMessage").innerText=result.msg;
                    document.getElementById("signUpErrorMessage").style.color="red";
                    localStorage.removeItem('signUpMessage');
                }
            }
        };
        xhr.send(jsonData);
    }
</script>
<!--End-pop-up-box-->

<!--start-footer-->
<div class="footer">
    <div class="container">
        <div class="footer-main">
            <div class="col-md-5 footer-left">
                <h5>联系我们</h5>
                <ul>
                    <li><a href="#"><span class="twt"> </span></a></li>
                    <li><a href="#"><span class="fb"> </span></a></li>
                    <li><a href="#"><span class="p"> </span></a></li>
                    <li><a href="#"><span class="yt"> </span></a></li>
                    <li><a href="#"><span class="in"> </span></a></li>
                </ul>
                <h5>地址 苏州市创新科技园</h5>
                <p>官方邮箱 <a href="crazylemon@gmail.com"> crazylemon@gmail.com</a></p>
                <p>官方电话  +86 17678627809</p>
            </div>
            <div class="col-md-7 footer-right">
                <h4>给我们的建议</h4>
                <span>
						<input type="text"  value="请在这里留下您的宝贵建议" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '请在这里留下您的宝贵建议';}">
						<input type="submit" value="提交">
					</span>
                <ul>
                    <li><a href="/index">首页</a></li>
                    <li><a href="/queryPlanList">周边跟团游</a></li>
                    <li><a href="/queryScenicList">热门景点</a></li>
                    <li><a href="/privateCustom">私人订制</a></li>
                    <li><a class="play-icon popup-with-zoom-anim" href="#small-dialog">登录</a></li>
                    <li><a class="play-icon popup-with-zoom-anim" href="#small-dialog2">注册</a></li>
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
        <div class="footer-text">
            <p>Copyright &copy; 2018-crazylemon项目组-沿途旅行</p>
        </div>
    </div>
    <a href="#header" id="toTop" class="scroll" style="display: block;"> <span id="toTopHover"
                                                                               style="opacity: 1;"> </span></a>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <div class="btn-group" style="z-index: 1000" >
        <a id="showPortrait" href="javascript:showFrame()" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  onblur="document.getElementById('showFrameDiv').style.display='none'" style="display: block;"> <span id="toTopl" style="opacity: 1;"> </span></a>
        <div class="dropdown-menu" id="showFrameDiv" style="display: none;position: absolute;z-index: 1000">
            <a class="dropdown-item" href="javascript:window.location.href='/modifyInformation'" id="modifyInformationA" style="display: none;width: 100%;padding: .25rem 1.5rem;clear: both;font-weight: 400;color: #212529;text-align: center;white-space: nowrap;background-color: transparent;border: 0;">修改资料</a>
            <a class="dropdown-item" href="javascript:window.location.href='/modifyPassword'" id="modifyPasswordA" style="display: none;width: 100%;padding: .25rem 1.5rem;clear: both;font-weight: 400;color: #212529;text-align: center;white-space: nowrap;background-color: transparent;border: 0;">修改密码</a>
            <a class="dropdown-item" href="javascript:window.location.href='/orderManager'" id="orderManageA" style="display: none;width: 100%;padding: .25rem 1.5rem;clear: both;font-weight: 400;color: #212529;text-align: center;white-space: nowrap;background-color: transparent;border: 0;">订单管理</a>
            <a class="dropdown-item" href="javascript:switchMember()" id="switchMemberA" style="display: none;width: 100%;padding: .25rem 1.5rem;clear: both;font-weight: 400;color: #212529;text-align: center;white-space: nowrap;background-color: transparent;border: 0;">切换账号</a>
            <a class="dropdown-item" href="javascript:logout()" id="logoutA" style="display: none;width: 100%;padding: .25rem 1.5rem;clear: both;font-weight: 400;color: #212529;text-align: center;white-space: nowrap;background-color: transparent;border: 0;">退出</a>
            <a class="play-icon popup-with-zoom-anim" href="#small-dialog" id="loginA" style="display: block;width: 100%;padding: .25rem 1.5rem;clear: both;font-weight: 400;color: #212529;text-align: center;white-space: nowrap;background-color: transparent;border: 0;"><span>登录 </span></a>
        </div>
    </div>
    <script>
        function saveOrder() {
            var touristAllInformationJson = localStorage.getItem("touristAllInformation");
            var data = localStorage.getItem('loginMessage');
            console.log(data);
            console.log(touristAllInformationJson);
            console.log("---------------------------");
            if(touristAllInformationJson!=null && data != null) {

                var touristAllInformation = JSON.parse(touristAllInformationJson);
                var objData = JSON.parse(data);

                var visitorId = JSON.parse(objData.data).data.visitorId;

                var touristName = touristAllInformation.touristName;
                var touristCellphone = touristAllInformation.touristCellphone;
                var touristIdCard = touristAllInformation.touristIdCard;

                if (window.XMLHttpRequest) {
                    xhr = new XMLHttpRequest();
                } else {
                    xhr = new ActiveXObject('Microsoft.XMLHTTP');
                }
                var url_ordersave = "/order/save";
                var touristList = [];

                //封装touristList信息
                for(var i=0;i<touristAllInformation.touristCount;i++){
                    var tourist = {
                        touristName : touristName[i],
                        touristPhone : touristCellphone[i],
                        touristIdcard : touristIdCard[i]
                    }
                    touristList[i] = tourist;
                }
                var mytype = touristAllInformation.type.split('/')[2];
                var objData = {};
                if( mytype === "scenic"){
                    objData = {
                        orderNum : touristAllInformation.touristCount,
                        visitorId : visitorId,
                        touristList : touristList,
                        scenicId : touristAllInformation.id,
                    };
                }else{
                    objData = {
                        orderNum : touristAllInformation.touristCount,
                        visitorId : visitorId,
                        touristList : touristList,
                        planId : touristAllInformation.id,
                    };
                }

                console.log(objData);
                var jsonData = JSON.stringify(objData);
                xhr.open("POST", url_ordersave, true);
                xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
                xhr.onreadystatechange =  function () {
                    if(xhr.readyState===4 && xhr.status ===200 ){
                        var result= JSON.parse(xhr.responseText);
                        console.log(result);
                        localStorage.removeItem("touristAllInformation");
                        var objOrder = {
                            orderResult : result,

                        };
                        //保存五分钟
                        objOrder.time = 300;
                        var orderJson = JSON.stringify(objOrder);
                        localStorage.setItem("order",orderJson);
                        window.location.href = "/orderDetailManager?orderId="+result.data;
                    }
                };
                xhr.send(jsonData);
            }else{
                document.getElementById("loginA").click();
                document.getElementById("loginErrorMessage").innerText = "请先完成登录";
            }


        }
        function showFrame() {
            document.getElementById("showFrameDiv").style.display = "";

        }
        function logout() {
            if (window.XMLHttpRequest) {
                xhr = new XMLHttpRequest();
            } else {
                xhr = new ActiveXObject('Microsoft.XMLHTTP');
            }
            var url_logout = "/yantu/login/logout";
            xhr.open("GET", url_logout, true);
            xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
            xhr.onreadystatechange =  function () {
                if(xhr.readyState===4 && xhr.status ===200 ){
                    console.log(xhr.responseText)
                    if(xhr.responseText !==null){
                        localStorage.removeItem('loginMessage');
                        window.location.href = "index";
                    }
                }
            };
            xhr.send();
        }
        function switchMember() {
            if (window.XMLHttpRequest) {
                xhr = new XMLHttpRequest();
            } else {
                xhr = new ActiveXObject('Microsoft.XMLHTTP');
            }
            var url_logout = "/yantu/login/logout";
            xhr.open("GET", url_logout, true);
            xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
            xhr.onreadystatechange =  function () {
                if(xhr.readyState===4 && xhr.status ===200 ){
                    console.log(xhr.responseText)
                    if(xhr.responseText !==null){
                        localStorage.removeItem('loginMessage');
                        document.getElementById("loginA").click();
                        document.getElementById("loginErrorMessage").innerText = "请先完成登录再支付";
                    }
                }
            };
            xhr.send();
        }
        function getProduct(productId,type) {
            if (window.XMLHttpRequest) {
                xhr = new XMLHttpRequest();
            } else {
                xhr = new ActiveXObject('Microsoft.XMLHTTP');
            }

            var url_product = type + productId;
            var productType = type.split('/')[2];
            // alert(productType);
            // alert(url_product);
            xhr.open("GET", url_product, true);
            xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var serviceResult = JSON.parse(xhr.responseText);
                    if (xhr.serviceResult !== null) {

                        var scenicData = serviceResult.data;

                        var num = document.getElementsByClassName("card").length;

                        var sum = 0.0;
                        var productInfo = '';
                        var productTbody = document.getElementById("productTbody");
                        productTbody.innerHTML = '<tr>\n' +
                            '                            <th width="10%">&nbsp;</th>\n' +
                            '                            <th width="30%" align="left">商品描述</th>\n' +
                            '                            <th width="20%" align="center">价格</th>\n' +
                            '                            <th width="20%" align="center">数量</th>\n' +
                            '                            <th width="20%" align="center">小计</th>\n' +
                            '                        </tr>';

                        if(productType == "scenic"){
                            sum = scenicData.scenicPrice * num;
                            productInfo = '<tr>\n' +
                                '                            <td class="product-cell cell-img">\n' +
                                '                                <a href="/scenicDetail/'+scenicData.scenicId +'" target="_blank">\n' +
                                '                                    <img class="p-img" src=\"'+scenicData.scenicPhotoList[0].photoSrc +'\">\n' +
                                '                                </a>\n' +
                                '                            </td>\n' +
                                '                            <td align="left"><a class="link p-name" href="/scenicDetail/'+ scenicData.scenicId +'" target="_blank">'+ scenicData.scenicName+':'+scenicData.scenicDescription+'</a></td>\n' +
                                '                            <td align="center">￥'+ scenicData.scenicPrice+'</td>\n' +
                                '                            <td align="center">x'+ num +'</td>\n' +
                                '                            <td align="center">￥'+ sum +'</td>\n' +
                                '                        </tr>';
                        }else if(productType == "plan"){
                            sum = scenicData.planPrice * num;
                            productInfo = '<tr>\n' +
                                '                            <td class="product-cell cell-img">\n' +
                                '                                <a href="/planDetail/'+scenicData.planId +'" target="_blank">\n' +
                                '                                    <img class="p-img" src=\"'+scenicData.scenicList[0].scenicPhotoList[0].photoSrc +'\">\n' +
                                '                                </a>\n' +
                                '                            </td>\n' +
                                '                            <td align="left"><a class="link p-name" href="/planDetail/'+ scenicData.planId +'" target="_blank">'+ scenicData.planName+':'+scenicData.planDescription+'</a></td>\n' +
                                '                            <td align="center">￥'+ scenicData.planPrice+'</td>\n' +
                                '                            <td align="center">x'+ num +'</td>\n' +
                                '                            <td align="center">￥'+ sum +'</td>\n' +
                                '                        </tr>';
                        }

                        productTbody.innerHTML += productInfo;
                        var sumPrice = document.getElementById("submit-total");
                        sumPrice.innerHTML = "￥" + sum;
                    }
                }
            };
            xhr.send();

        }

        window.onload = function () {

            var data = localStorage.getItem('loginMessage');
            console.log(data);
            if (data != null) {
                var objData = JSON.parse(data);
                if (new Date().getTime() - objData.time > 1000 * 60 * 30) {
                    localStorage.removeItem('loginMessage');
                } else {
                    document.getElementById("showPortrait").style.backgroundImage= "url("+JSON.parse(objData.data).data.visitorPortrait+")";
                    document.getElementById("loginA").style.display = "none";
                    document.getElementById("logoutA").style.display = "block";
                    document.getElementById("switchMemberA").style.display = "block";
                    document.getElementById("modifyPasswordA").style.display = "block";
                    document.getElementById("modifyInformationA").style.display = "block";
                    document.getElementById("orderManageA").style.display = "block";
                }
            }

            var touristAllInformationJson = localStorage.getItem("touristAllInformation");
            console.log(touristAllInformationJson);
            if(touristAllInformationJson!=null){

                var touristAllInformation = JSON.parse(touristAllInformationJson);
                //查看id和touristCount
                // alert("id = " + touristAllInformation.id);
                // alert("count = "+touristAllInformation.touristCount);
                var touristName = touristAllInformation.touristName;
                var touristCellphone = touristAllInformation.touristCellphone;
                var touristIdCard = touristAllInformation.touristIdCard;
                //循环遍历构建出游人信息
                var touristInfo = document.getElementById("touristInfo");
                touristInfo.innerHTML = "";
                for(var i=0;i<touristAllInformation.touristCount;i++){
                    var cardInfo = '<div class="card" style="width: 520px;float: left;margin: 5px;">\n' +
                        '                        <div class="card-body">\n' +
                        '                            <h4 class="card-title">'+touristName[i] +'</h4>\n' +
                        '                            <p class="card-text"><span>电  话：</span>'+ touristCellphone[i] +'</p>\n' +
                        '                            <p class="card-text"><span>身份证：</span> '+ touristIdCard[i] +'</p>\n' +
                        '                        </div>\n' +
                        '                    </div>';

                    var formData = "";
                    touristInfo.innerHTML += cardInfo;


                }
                //封装出游人信息
                getProduct(touristAllInformation.id,touristAllInformation.type);


            }

        }
    </script>
</div>
<!--end-footer-->
<div style="display:none">
    <script src='http://v7.cnzz.com/stat.php?id=155540&web_id=155540' language='JavaScript'
            charset='gb2312'></script>
</div>
</body>
</html>